<link rel="stylesheet" href="/css/home.css">

<h1>Codieal/ <%=title%></h1>

<section id="feed-posts">
    <h4>Posts</h4>
    <% if (locals.user) {%>
    <form action="/posts/create" method="post" id="new-post-form">
        <textarea name="content"  cols="30" rows="5" placeholder="What's in your mind!! Share it with your friends " required></textarea>
        <input type="submit" value="Post">
    </form>
 <%}%>
    <div id="posts-list-container">
        <ul>
            <% for (post of posts) {%>
           <li>
               <!--- check for user if he can delete it-->
               <p><% if ((locals.user) && (locals.user.id == post.user.id)) {%>
                   <small>
                       <a href="/posts/destroy/<%= post.id%>">Delete</a>
                   </small>
                   <%}%>

               <%= post.content %>
               <br>
               <small><%= post.user.name %></small>
            </p>
            <div class="post-comments">
            <% if (locals.user) {%>
            <form action="/comments/create" method="post">
                <textarea name="content"  cols="20" rows="2" placeholder="write your comment here" required></textarea>
                <input type="submit" value="Comment">
                <input type="hidden" name="post" value="<%= post._id%>">
            </form>
            <%}%>

            <div class="post-comments-list">
                <ul id ="post-comments-<%= post._id%>">
                    <% for (comment of post.comments){%>
                        <li>
                                <p>
                                    <!---todo add chck so that user can deeltet its post comments-->
                                    <% if ((locals.user) && (locals.user.id == comment.user.id)) {%>
                                        <small>
                                            <a href="/comments/destroy/<%=comment.id%>">Delete</a>
                                        </small>
                                        <%}%>
                                    <%= comment.content%>
                                    <br>
                                    <small><%= comment.user.name%></small>
                                </p>
                        </li>

                     
                    <%}%>   
                </ul>
            </div>


        </div>
           
            </li>
            <%}%>
           </ul>

           
           
           
            
        
    </div>
</section>
        
